<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì£¼ì°¨ì¥ ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 20px; }
    h2, h3 { margin-bottom: 16px; }
    input, select { padding: 6px; margin: 4px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    button { padding: 6px 12px; margin: 2px; cursor: pointer; }
  </style>
</head>
<body>
<h2>ğŸ…¿ï¸ ì£¼ì°¨ì¥ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>

<script>
    const isAdmin = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”") === "admin1234";
    if (!isAdmin) {
      document.body.innerHTML = '<h2>ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</h2>';
      throw new Error("ì ‘ê·¼ ê±°ë¶€ë¨");
    }
  </script>

<h3>ğŸ” ì£¼ì°¨ì¥ ê²€ìƒ‰</h3>
<input type="text" id="searchInput" placeholder="ì£¼ì°¨ì¥ ì´ë¦„ ê²€ìƒ‰" oninput="loadParkingList()" />

<h3>â• ì£¼ì°¨ì¥ ì¶”ê°€</h3>
<form onsubmit="addParking(); return false;">
    <input id="addParkingName" placeholder="parkingName (ê³ ìœ ê°’)" required />
    <input id="addName" placeholder="í‘œì‹œ ì´ë¦„ (name)" required />
    <input id="addLocation" placeholder="ìœ„ì¹˜" required />
    <input id="addSpots" type="number" placeholder="ì´ ìë¦¬ ìˆ˜" required />
    <input id="addEmptySpots" type="number" placeholder="ë¹ˆ ìë¦¬ ìˆ˜" required />
    <button type="submit">ì¶”ê°€</button>
</form>

<h3>ğŸ“‹ ì „ì²´ ì£¼ì°¨ì¥ ëª©ë¡</h3>
<table>
    <thead>
    <tr>
        <th>parkingName</th>
        <th>name</th>
        <th>location</th>
        <th>ì´ ìë¦¬</th>
        <th>ë¹ˆ ìë¦¬</th>
        <th>ìˆ˜ì •/ì‚­ì œ</th>
    </tr>
    </thead>
    <tbody id="parking-table-body"></tbody>
</table>

<h3>âœï¸ IDë¡œ ì£¼ì°¨ì¥ ìˆ˜ì •</h3>
<form onsubmit="updateById(); return false;">
    <input id="updateId" type="number" placeholder="ìˆ˜ì •í•  ì£¼ì°¨ì¥ ID" required />
    <input id="updateName" placeholder="ë³€ê²½í•  name" required />
    <input id="updateLocation" placeholder="ë³€ê²½í•  location" required />
    <input id="updateSpots" type="number" placeholder="ë³€ê²½í•  ì´ ìë¦¬ ìˆ˜" required />
    <input id="updateEmptySpots" type="number" placeholder="ë³€ê²½í•  ë¹ˆ ìë¦¬ ìˆ˜" required />
    <button type="submit">ID ê¸°ì¤€ ìˆ˜ì •</button>
</form>

<h3>ğŸ—‘ï¸ IDë¡œ ì£¼ì°¨ì¥ ì‚­ì œ</h3>
<form onsubmit="deleteById(); return false;">
    <input id="deleteByIdInput" type="number" placeholder="ì‚­ì œí•  ì£¼ì°¨ì¥ ID" required />
    <button type="submit">ID ê¸°ì¤€ ì‚­ì œ</button>
</form>

<script>
    const API_BASE = 'https://port-0-backend-m9z3p2p78bad92ca.sel4.cloudtype.app/';

    async function loadParkingList() {
      const res = await fetch(API_BASE);
      const data = await res.json();
      const search = document.getElementById('searchInput').value.toLowerCase();

      const tbody = document.getElementById('parking-table-body');
      tbody.innerHTML = '';

      data.filter(p => !search || p.parkingName.toLowerCase().includes(search)).forEach(p => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${p.parkingName}</td>
          <td><input id="name-${p.parkingName}" value="${p.name ?? ''}" /></td>
          <td><input id="location-${p.parkingName}" value="${p.location ?? ''}" /></td>
          <td><input id="spots-${p.parkingName}" type="number" value="${p.spots}" /></td>
          <td><input id="emptySpots-${p.parkingName}" type="number" value="${p.emptySpots}" /></td>
          <td>
            <button onclick="save('${p.parkingName}')">ì €ì¥</button>
            <button onclick="remove('${p.parkingName}')">ì‚­ì œ</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function save(parkingName) {
      const name = document.getElementById(`name-${parkingName}`).value;
      const location = document.getElementById(`location-${parkingName}`).value;
      const spots = document.getElementById(`spots-${parkingName}`).value;
      const emptySpots = document.getElementById(`emptySpots-${parkingName}`).value;

      const res = await fetch(`${API_BASE}/name/${encodeURIComponent(parkingName)}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, location, spots, emptySpots })
      });

      alert(res.ok ? `\"${parkingName}\" ìˆ˜ì • ì™„ë£Œ` : `ìˆ˜ì • ì‹¤íŒ¨: ${parkingName}`);
      loadParkingList();
    }

    async function remove(parkingName) {
      if (!confirm(`${parkingName}ì„(ë¥¼) ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      const res = await fetch(`${API_BASE}/name/${encodeURIComponent(parkingName)}`, { method: 'DELETE' });
      alert(res.ok ? `ì‚­ì œ ì™„ë£Œ: ${parkingName}` : `ì‚­ì œ ì‹¤íŒ¨`);
      loadParkingList();
    }

    async function addParking() {
      const body = {
        parkingName: document.getElementById('addParkingName').value,
        name: document.getElementById('addName').value,
        location: document.getElementById('addLocation').value,
        spots: parseInt(document.getElementById('addSpots').value),
        emptySpots: parseInt(document.getElementById('addEmptySpots').value),
      };

      const res = await fetch(`${API_BASE}/add`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      alert(res.ok ? 'ì¶”ê°€ ì™„ë£Œ' : 'ì¶”ê°€ ì‹¤íŒ¨');
      loadParkingList();
    }

    async function updateById() {
      const id = document.getElementById('updateId').value;
      const body = {
        name: document.getElementById('updateName').value,
        location: document.getElementById('updateLocation').value,
        spots: parseInt(document.getElementById('updateSpots').value),
        emptySpots: parseInt(document.getElementById('updateEmptySpots').value),
      };

      const res = await fetch(`${API_BASE}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      alert(res.ok ? `ID ${id} ìˆ˜ì • ì™„ë£Œ` : `ìˆ˜ì • ì‹¤íŒ¨: ID ${id}`);
      loadParkingList();
    }

    async function deleteById() {
      const id = document.getElementById('deleteByIdInput').value;
      const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
      alert(res.ok ? `ID ${id} ì‚­ì œ ì™„ë£Œ` : `ì‚­ì œ ì‹¤íŒ¨: ID ${id}`);
      loadParkingList();
    }

    loadParkingList();
  </script>
</body>
</html>
